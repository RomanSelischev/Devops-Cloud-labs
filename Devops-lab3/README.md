# Лабораторная работа №3

Задание: Cделать, чтобы после пуша в ваш репозиторий автоматически собирался докер образ и результат его сборки сохранялся куда-нибудь. (например, если результат - текстовый файлик, он должен автоматически сохраниться на локальную машину, в ваш репозиторий или на ваш сервер).

1) Для удобной работы создаем [отдельный репозиторий](https://github.com/RomanSelischev/Devops_lab03_rep), в котором и будет выполняться задание

2) Создаем файл .yml в дирректории .github/workflows, с помощью которого и будет осуществляться пуш сборки на Docker Hub после пуша в репозитории.
   хорошая:
   ![a7e5c054-b3c4-4687-9f46-ac663c3735e2](file:///C:/Users/92428/OneDrive/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/Typedown/a7e5c054-b3c4-4687-9f46-ac663c3735e2.png)
   плохая:
   ![ad23f10c-e580-4516-b1a4-f03311cad58a](file:///C:/Users/92428/OneDrive/%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/Typedown/ad23f10c-e580-4516-b1a4-f03311cad58a.png)

3) Плохие практики в CI/CD и их исправления
   
   * **Логин и пароли в коде**  
     В плохом примере логин и токен Docker Hub были указаны прямо в workflow.  
     **Почему плохо:** секреты могут быть слиты и использованы злоумышленниками.  
     **Как исправить:** хранить секреты в CI/CD секретах, например, в GitHub Secrets (`${{ secrets.LOGIN }}` и `${{ secrets.PASSWORD }}`).
   
   * **Использование `latest` для Docker образа**  
     В плохом примере образ пушился с тегом `latest`.  
     **Почему плохо:** нет контроля версий образов, сборка может непредсказуемо обновиться.  
     **Как исправить:** использовать фиксированные теги, например `v1.0.0`.
   
   * **Игнорирование ошибок с `continue-on-error: true`**  
     В плохом примере добавляли `continue-on-error: true`.  
     **Почему плохо:** ошибки сборки или пуша игнорируются, workflow может завершиться успешно, хотя процесс не удался.  
     **Как исправить:** не использовать `continue-on-error`, позволять workflow падать при ошибках.
   
   * **Использование `npm install` вместо `npm ci`**  
     В плохом примере зависимости устанавливали через `npm install`.  
     **Почему плохо:** может перезаписываться `package-lock.json`, версии зависимостей между средами могут расхождаться, повышается риск выполнения вредоносного кода.  
     **Как исправить:** использовать `npm ci --ignore-scripts` для безопасной и стабильной установки зависимостей.
   
   * **Прямое хардкодирование Dockerfile и контекста**  
     В плохом примере `file` и `context` были захардкожены.  
     **Почему плохо:** снижает гибкость workflow, трудно использовать другой путь или репозиторий.  
     **Как исправить:** явно указывать `file` и `context`, но лучше через переменные или относительные пути, чтобы workflow был гибким и переносимым.

4) После внесённых изменений время установки зависимостей сократилось, CI/CD файл стал более гибким и теперь позволяет легко изменять сервер и пути через переменные окружения без необходимости редактировать сам файл. Кроме того, повысилась безопасность, так как секреты больше не сохраняются в репозитории или логах CI/CD. (Пример запуска рабочего процесса приведён ниже, в лабораторной со звёздочкой).

5) Чтобы войти в аккаунт репозитория Docker Hub с нашего репозитория были сгенерированы секреты LOGIN  (логин в Docker Hub) и PASSWORD (токен с Docker Hub).
   ![06a67dbf-8e47-437a-a56f-0507eae60695](./photo/06a67dbf-8e47-437a-a56f-0507eae60695.png)![2baab351-6e25-45bd-b678-3e92141f06f8](./photo/2baab351-6e25-45bd-b678-3e92141f06f8.png)
   Добавляем teor.py и dockerfile, после пуша видим, что сборка осуществилась и выгрузилась в Docker Hub![loading-ag-141](./photo/b318db34-1867-43f4-9ee7-13e0a9e77fde.png)

![loading-ag-143](./photo/b9238351-efe5-4a28-937c-0bb6e27092c9.png)
