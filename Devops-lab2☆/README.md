# Лаб2*

---

![loading-ag-177](./screenshots/f9868b28-99bd-4e41-831b-5ff6bac0131c.png)

Dockerfile для приложения:

![loading-ag-179](./screenshots/5b073329-955a-46b2-9383-283374725e8c.png)

### "Злой" Docker Compose file



![loading-ag-181](./screenshots/212cb612-5414-441f-8e17-6a3a7d6e21da.png)

- Неявное указание версии образа базы данных

- Если в конфигурации сервиса `db` не задана конкретная версия образа, Docker будет использовать последнюю доступную. Это может привести к проблемам совместимости, так как новая версия базы данных способна содержать изменения, несовместимые с приложением.

- Отсутствие зависимости между сервисами:
  
  - При отсутствии директивы `depends_on` порядок запуска контейнеров не гарантируется. В результате приложение может попытаться подключиться к базе данных до того, как она будет полностью инициализирована, что вызовет ошибки при установлении соединения.

- нет ограничений ресурсов:
  
  - в текущем файле не заданы лимиты по CPU и памяти для сервисов. Это означает, что контейнеры смогут бесконтрольно потреблять ресурсы хоста, что в свою очередь может негативно сказаться на производительности других приложений и сервисов. Для предотвращения таких ситуаций рекомендуется задавать лимиты с помощью секции `deploy.resources.limits`.

---

### "Хороший" Docker Compose file

![loading-ag-183](./screenshots/079416bc-d127-45ec-89cd-e676ed5d8015.png)

- Указана конкретная версия образа базы данных — `postgres:13.4`.
- Добавлена директива `depends_on`, обеспечивающая запуск контейнера с БД до старта приложения.
- Для сервисов заданы ограничения на использование CPU и оперативной памяти.

---

### Просмотр работы контейнеров

собираем контейнеры и запускаем:

`docker-compose -f docker-compose.good.yml build`

`docker-compose -f docker-compose.bad.yml build`

`docker-compose -f docker-compose.bad.yml up`

![loading-ag-185](./screenshots/762b2380-dfcc-46dc-86c9-014129815062.png)

`docker-compose -f docker-compose.good.yml up`

![loading-ag-187](./screenshots/3eaf8e63-49a1-47f3-8f46-fd7a15b80fab.png)

показатели запущенных контейнеров:

злой :

![статы плохого](./screenshots/bad_stats.jpg)

хороший:

![лимиты](./screenshots/good_stats.jpg)

Команды для остановки контейнеров:

`docker-compose -f docker-compose.good.yml down`

`docker-compose -f docker-compose.bad.yml down`

---

### Настройка сетевой изоляции

Настроим сетевую изоляцию в Docker Compose. В исходной конфигурации её нет, поэтому контейнеры могут свободно обмениваться данными друг с другом, включая пересылку пакетов:

![loading-ag-191](./screenshots/767344d4-e11d-49c8-abb6-fee2837bcdfb.png)

после пересборки и запуска не пингуется

![loading-ag-193](./screenshots/2ae0e58f-342c-4236-94c3-416e50fc26aa.png)

![loading-ag-195](./screenshots/b2494213-cb9c-4808-8c76-5b7417cf7714.png)

**_Итог:_** с помощью Docker Compose удалось успешно развернуть небольшое веб-приложение и выполнить базовые настройки контейнера с использованием современных инструментов. Мы освоили эффективные подходы к работе с Docker Compose и правильную настройку взаимодействия контейнеров внутри сети.
